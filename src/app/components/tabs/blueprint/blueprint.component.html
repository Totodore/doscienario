<div class="outer-wrapper" *ngIf="show">
  <button *ngIf="scrollPoles.has('south')" mat-icon-button class="bottom" (click)="onWiden('south')">
    <mat-icon>keyboard_arrow_down</mat-icon>
  </button>
  <button *ngIf="scrollPoles.has('east')" mat-icon-button class="right" (click)="onWiden('east')">
    <mat-icon>keyboard_arrow_right</mat-icon>
  </button>
  <button *ngIf="scrollPoles.has('north')" mat-icon-button class="top" (click)="onWiden('north')">
    <mat-icon>expand_less</mat-icon>
  </button>
  <div class="wrapper" #wrapper [class.grabbing]="drawState === 'moving'" (scroll)="onScroll($any($event))">
    <!-- <canvas #viewport *ngIf="blueprint"></canvas> -->
    <div class="overlay" *ngIf="blueprint" #overlayEl
			[class.dragging]="drawState == 'dragging'"
			[class.grid]="gridMode"
			(mousedown)="onMouseDown($event)" 
			(mouseup)="onMouseUp($event)" 
			(mousemove)="onMouseMove($event)"
			(click)="onClick($event)">

			<svg>
				<g *ngFor="let rel of rels" [overlay]="overlayEl" [data]="rel" relation></g>
				<g *ngIf="ghostNode" [overlay]="overlayEl" [data]="ghostNode" relation></g>
				<!-- <app-relation ></app-relation> -->
			</svg>
      <app-node [blueprintId]="id" [tabId]="tabId" class="root" #rootEl [data]="root" (relationBegin)="beginRelation(rootEl, $event)"></app-node>
      <app-node #nodeEl *ngFor="let node of nodes"
				[blueprintId]="id" [tabId]="tabId"
        [style.left.px]="node.x" [style.top]="'calc(50% + ' + node.y + 'px)'"
        [data]="node" (relationBegin)="beginRelation(nodeEl, $event)"
        (remove)="onRemove(nodeEl)" (relationBind)="bindRelation(nodeEl, $event)"></app-node>
      <app-node *ngIf="ghostNode" class="skeleton" [style.left.px]="ghostNode.ex" [style.top]="'calc(50% + ' + (ghostNode.ey - overlayEl.clientHeight / 2) + 'px'"></app-node>
    </div>
    <h1 *ngIf="!blueprint">Chargement du document...</h1>
  </div>
</div>
